<!--
  Template Credits :
  https://templatemo.com/tm-572-designer
  https://bootstrapious.com/p/boutique-bootstrap-e-commerce-template
  Thank You!
-->

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SP DVD | Admin</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- gLightbox gallery-->
    <link rel="stylesheet" href="../CA2_VENDOR_FILES/glightbox/css/glightbox.min.css">
    <!-- Range slider-->
    <link rel="stylesheet" href="../CA2_VENDOR_FILES/nouislider/nouislider.min.css">
    <!-- Choices CSS-->
    <link rel="stylesheet" href="../CA2_VENDOR_FILES/choices.js/public/assets/styles/choices.min.css">
    <!-- Swiper slider-->
    <link rel="stylesheet" href="../CA2_VENDOR_FILES/swiper/swiper-bundle.min.css">
    <!-- Google fonts-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300;400;700&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Martel+Sans:wght@300;400;800&amp;display=swap">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="../CA2_CSS/style.default.css" id="theme-stylesheet">
    <!-- Main stylesheet-->
    <link rel="stylesheet" href="../CA2_CSS/main.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="../CA2_GRAPHICS/dvd.png">
  </head>

  <body class="mainBody">
    <div class="page-holder">
      <!--Navigation Bar-->
      <header class="header bg-white">
        <div class="container px-lg-3">
          <nav class="navbar navbar-expand-lg navbar-light py-3 px-lg-0"><a class="navbar-brand"><span class="fw-bold text-uppercase text-dark">SP DVD RENTAL STORE</span></a>
            <button class="navbar-toggler navbar-toggler-end" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav ms-auto">               
                <li class="nav-item"><a class="nav-link" href="../CA2_HTML_PUBLIC/admin.html"> <i class="fas fa-angle-left me-1 text-gray"></i>Back</a></li>
                <li class="nav-item"><a class="nav-link" href="../CA2_HTML_PUBLIC/staff_login.html"><i class="fas fa-user me-1 text-gray fw-normal"></i>Logout</a></li>
              </ul>
            </div>
          </nav>
        </div>
      </header>

      <!-- Main Body Section -->
      <div class="container main-section customerPage">
        <section class="hero pb-3 d-flex align-items-center">
          <div class="container py-5 mb-5 d-flex justify-content-center">
            <div class="row px-lg-5">
              <div>
                <center><p class="text-muted text-uppercase mb-2">Admin User</p><p class='text-uppercase mb-2' id="loggedInAs" style="color:white"></p></center>
                <center><h1 class="h2 text-uppercase main-text">ADD A NEW CUSTOMER RECORD BELOW.</h1></center>
              </div>
            </div>
          </div>
        </section>
    </div>

    <form>
        <div class="container col-lg-12">
            <!--Table for Adding Customer Personal Details-->
            <table class="table table-bordered">
                <tbody>
                    <th colspan="2">
                        <!--Main Text for the Personal Details Group-->
                        <center><p class="text-uppercase text-white" style="margin-top:20px">Personal Details</p></center>
                    </th>
                    <!--First name-->
                    <tr class="text-center">
                        <td class="pt-3 col-lg-4" style="color:white">First Name</td>
                        <td><input type="text" class="form-control" id="cust_firstname" name="cust_firstname" placeholder="Enter Customer's First Name" required></td>
                    </tr>
                    <!--Last name-->
                    <tr class="text-center">
                        <td class="pt-3 col-lg-4" style="color:white">Last Name</td>
                        <td><input type="text" class="form-control" id="cust_lastname" name="cust_lastname" placeholder="Enter Customer's Last Name" required></td>
                    </tr>
                    <!--Email-->
                    <tr class="text-center">
                        <td class="pt-3 col-lg-4" style="color:white">Email</td>
                        <td><input type="email" class="form-control" id="cust_email" name="cust_email" placeholder="Enter Customer's Email Address" required><span id="email-conflict"></span></td>
                    </tr>
                    <!--Phone Number-->
                    <tr class="text-center">
                        <td class="pt-3 col-lg-4" style="color:white">Phone Number</td>
                        <td><input type="number" class="form-control" id="phone" name="phone" placeholder="Enter Customer's Phone Number" required></td>
                    </tr>
                    <!--Password-->
                    <tr class="text-center">
                      <td class="pt-3 col-lg-4" style="color:white">Password</td>
                      <td><input type="text" class="form-control" id="cust_password" name="cust_password" placeholder="Enter Customer's Password" required></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="container col-lg-12" style="margin-top:180px">
            <!--Table for Adding Customer Residential Details-->
            <table class="table table-bordered">
                <tbody>
                    <th colspan="2">
                        <!--Main Text for the Residential Details Group-->
                        <center><p class="text-white text-uppercase" style="margin-top:20px">Residential Details</p></center>
                    </th>
                    <!--Address Line 1-->
                    <tr class="text-center">
                        <td class="pt-3 col-lg-4" style="color:white">Address Line 1</td>
                        <td><input type="text" class="form-control" id="address1" name="address1" placeholder="Enter Customer's Address Line 1" required></td>
                    </tr>
                    <!--Address Line 2-->
                    <tr class="text-center">
                        <td class="pt-3 col-lg-4" style="color:white">Address Line 2</td>
                        <td><input type="text" class="form-control" id="address2" name="address2" placeholder="Enter Customer's Address Line 2 (Optional)"></td>
                    </tr>
                    <!--District-->
                    <tr class="text-center">
                        <td class="pt-3 col-lg-4" style="color:white">District</td>
                        <td><input type="text" class="form-control" id="district" name="district" placeholder="Enter Customer's District" required></td>
                    </tr>
                    <!--City ID-->
                    <tr class="text-center">
                        <td class="pt-3 col-lg-4" style="color:white">City ID</td>
                        <td><input type="number" class="form-control" id="cityid" name="cityid" placeholder="Enter Customer's City ID" required></td>
                    </tr>
                    <!--Postal Code-->
                    <tr class="text-center">
                        <td class="pt-3 col-lg-4" style="color:white">Postal Code</td>
                        <td><input type="number" class="form-control" id="postal" name="postal" placeholder="Enter Customer's Postal Code" required></td>
                    </tr>
                    <!--Store Address-->
                    <tr class="text-center">
                        <td class="pt-3 col-lg-4" style="color:white">Store Address</td>
                        <td>
                            <select name="store" class="form-select" aria-label="Default select example" id="store" onChange="this.form.click()">
                                <option value="">Select Store</option>
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!--Submit and Reset Buttons-->
            <button class="main-button-customer mt-2" input type="submit" id="btn_confirm">CONFIRM CUSTOMER DETAILS</button>
            <button class="reset-button-customer mt-3 mb-5" input type="reset" id="btn_reset">RESET</button>
        </div>
    </form>

    <!-- Implement the Backend code for addition of a new actor to the database -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" 
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>

    <script>
        $(function() {
            if(!localStorage['token']) {
                window.alert("Unauthorised Access. Please Login.");
                window.location.href = "staff_login.html";
            }
            // If Logout, Remove Token !!
            $('#logout').click(event => {
              localStorage.removeItem("token");
              localStorage.removeItem("status");
              localStorage.removeItem("name");
              window.location.href="staff_login.html"
            })
            // Getting name of Admin from localStorage
            var adminName = JSON.parse(localStorage.getItem("name"));
            document.getElementById("loggedInAs").innerHTML = "Logged in as: " + adminName;
            
            let store_id;
            function getStoreAddress(){
                $.ajax({
                  "url": "http://localhost:3000/store/address",
                  "method": "GET",
                  "timeout": 0,
                  success: function(getStoreAddress) {
                    for (var i=0; i < getStoreAddress.length; i++) {
                        $("#store").append($("<option>", {value: getStoreAddress[i].store_id, text: getStoreAddress[i].address}))
                    }
                  }
                });
              }
              getStoreAddress();

            $("#store").change(function() {
                store_id = $(this).val();
            })

            $("#cust_email").on("input", function() {
                $("#email-conflict").text("")
            })

            $("#btn_confirm").click(function(event) {
                // Event Handler when Clicked on Submit
                console.log(event)
                // Prevent form submission
                event.preventDefault();
                // Set settings for url
                var settings = {
                    "url": "http://localhost:3000/customers",
                    "method": "POST",
                    "timeout": 0,
                    "headers": {
                      "Authorization": "Bearer " + localStorage['token'],
                      "Content-Type": "application/json"
                    },
                    "data": JSON.stringify({
                      "store_id": store_id,  
                      "first_name": $("#cust_firstname").val(),
                      "last_name": $("#cust_lastname").val(),
                      "email": $("#cust_email").val(),
                      "password":$("#cust_password").val(),
                      "address": {
                        "address_line1": $("#address1").val(),
                        "address_line2": $("#address2").val(),
                        "district": $("#district").val(),
                        "city_id": $("#cityid").val(),
                        "postal_code": $("#postal").val(),
                        "phone": $("#phone").val()
                      }
                    }),
                  };

                // Check if there are missing fields 
                if ($("#cust_email").val() == "" || $("#address1").val() == "" ||  $("#district").val() == "" ||  $("#cityid").val() == "" ||  $("#postal").val() == "" ||  $("#phone").val() == "" || store_id == undefined || $("#cust_password").val() == "" || $("#cust_firstname").val() == "" || $("#cust_lastname").val() == ""){
                    window.alert("Please Fill Out All Required Fields.")
                } 
                    $.ajax(settings)
                    .done(function (response) {
                        console.log(response);
                        window.alert(response.success_msg);
                        window.location.href = "admin.html"
                    })
                    .fail((response) => {
                        if (response.status===409 && $("#cust_email").val() != ""){
                            $("#email-conflict").text("Email exists in database. Please enter another email.");
                            $("#cust_email").val("");
                        } else {
                            console.log(response.responseJSON);
                        }
                    });
            });
        });
        </script>

      <!-- JavaScript files -->
      <script src="../CA2_VENDOR_FILES/bootstrap/js/bootstrap.bundle.min.js"></script>
      <script src="../CA2_VENDOR_FILES/glightbox/js/glightbox.min.js"></script>
      <script src="../CA2_VENDOR_FILES/nouislider/nouislider.min.js"></script>
      <script src="../CA2_VENDOR_FILES/swiper/swiper-bundle.min.js"></script>
      <script src="../CA2_VENDOR_FILES/choices.js/public/assets/scripts/choices.min.js"></script>
      <script src="../CA2_JAVASCRIPT/front.js"></script>

      <!-- FontAwesome CSS - loading as last, so it doesn't block rendering-->
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    </div>
  </body>
</html>